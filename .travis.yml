language: cpp
compiler:
  #  - gcc
  - clang
before_install:
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
  - sudo add-apt-repository --yes ppa:chris-lea/node.js 
  - sudo apt-get -qq update
install:
  - sudo apt-get -qq install rake bison git gperf g++-4.8 libev-dev libevent-dev libjansson-dev libjemalloc-dev libxml2-dev libssl-dev zlib1g-dev
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8"; fi
  - git clone https://github.com/h2o/qrintf.git
  - cd qrintf
  - sudo make install PREFIX=/usr/local
  - cd ..
  - sudo apt-get install -y nodejs
  - sudo npm install -g mocha
  - which npm
script:
  - git clone https://github.com/mruby/mruby.git
  - cd mruby
  - cp -f ../build_config.rb .
  - rake
  - cd ..
  - rake
  - cd test
  - npm install ref kjunichi/node-ffi
  - mocha -gc --reporter spec
